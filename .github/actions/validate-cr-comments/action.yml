name: 'Check Deployment Comment for Change Request Number'
description: 'Ensures deployment comments include a change request number.'

outputs:
  valid:
    description: 'Boolean indicating if the comment is valid'
runs:
  using: 'composite'
  steps:
  - name: Get deployment comment
    id: cr_comment
    shell: bash
    run: echo "DEPLOY_COMMENT=${{ github.event.head_commit.message }}" >> $GITHUB_ENV

  - name: Check for Change Request Number
    id: check_cr
    shell: bash
    run: |
      if echo "${{ env.DEPLOY_COMMENT }}" | grep -qE "CR[0-9]+"; then
        echo "::set-output name=valid::true"
      else
        echo "::set-output name=valid::false"
      fi

  - name: Print the valid comment status
    id: Print
    run: echo "Valid= '${{ steps.check_cr.outputs.valid}}'"
    shell: bash

